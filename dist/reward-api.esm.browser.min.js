/**
 * reward-api v1.0.26
 * (c) 2020 Jun Tsai
 * @license Apache-2.0
 */
import e from"vue";import t from"vuex";import{promisifyAll as n}from"wx-promise-pro";var a={haodankuApi:"https://v2.api.haodanku.com",haodankuKey:"gofanli",haodanku_taobao_name:"zhyj_cn",taobaoke_pid:"mm_19052242_1281300405_110017350452",api:"https://api.gofanli.cn",isWx:!1};const i=function(){if(a.isWx||"undefined"!=typeof wx)return new(require("flyio/dist/npm/wx"));return require("flyio")}(),o={headers:{"content-type":"application/x-www-form-urlencoded"}},r=(e,t)=>i.post(`${a.api}${e}`,t,o).then(e=>e.data),s=(e,t)=>i.get(`${a.api}${e}`,t).then(e=>e.data),d=e=>{i.config.headers=Object.assign(i.config.headers,{Authorization:"Bearer "+e})};var c={public:{announces:()=>s("/public/announces"),slides:()=>s("/public/slides")},admin:{add_card:({no:e,secret:t,amount:n,created_id:a})=>r("/admin/card/add",{no:e,secret:t,amount:n,created_id:a}),cards:({page:e,size:t,sort:n})=>r("/admin/card/list",{page:e,size:t,sort:n}),add_slide:({img_url:e,url:t,status:n})=>r("/admin/slide/add",{img_url:e,url:t,status:n}),delete_slide:e=>r("/admin/slide/delete",{id:e}),update_status:({id:e,status:t})=>r("/admin/slide/status",{id:e,status:t}),slides:()=>s("/admin/slide/list"),add_announce:({content:e,url:t})=>r("/admin/announce/add",{content:e,url:t}),delete_announce:e=>r("/admin/announce/delete",{id:e}),announces:()=>s("/admin/announce/list"),users:({page:e,size:t,sort:n})=>r("/admin/users",{page:e,size:t,sort:n})},consumption:{add:({amount:e,item_id:t,item_img:n,item_link:a})=>r("/consumption/add",{amount:e,item_id:t,item_img:n,item_link:a}),list:({page:e,size:t,sort:n})=>r("/consumption/list",{page:e,size:t,sort:n})},recharge:{add:({no:e,secret:t})=>r("/recharge/add",{no:e,secret:t}),list:({page:e,size:t,sort:n})=>r("/recharge/list",{page:e,size:t,sort:n})},user:{setToken:d,clearToken:()=>{delete i.config.headers.Authorization},info:()=>s("/user/info"),sendSms:e=>r("/user/sendSms",{phone:e}),login:({phone:e,code:t})=>r("/user/login",{phone:e,code:t}).then(e=>(d(e.token),e))},wx:{login:e=>r("/wx/login",e).then(e=>(d(e.token),e))}};i.interceptors.request.use(e=>{e.url.indexOf("haodanku.com")>0&&delete e.headers.Authorization});const u={headers:{"content-type":"application/x-www-form-urlencoded"}};function m(e,t,n,o){const r=Object.assign(n,o);let s=a.haodankuApi+"/"+e+"/apikey/"+a.haodankuKey;return t.forEach(e=>{r.hasOwnProperty(e)&&(s+="/"+e+"/"+r[e])}),i.get(s,{},u).then(e=>{const t="string"==typeof e.data?JSON.parse(e.data):e.data;if(0===t.code)throw console.error("\u6293\u53d6\u6570\u636e\u5931\u8d25,\u670d\u52a1\u5668\u6d88\u606f:",t.msg),new Error(t.msg);return t})}var l=Object.freeze({__proto__:null,itemlist:e=>{return m("itemlist",["nav","cid","back","min_id","sort","price_min","price_max","sale_min","sale_max","coupon_min","coupon_max","tkrates_min","tkrates_max","tkmoney_min","item_type"],{nav:3,cid:0,back:10,minId:1},e)},ratesurl:e=>{const t={apikey:a.haodankuKey,tb_name:a.haodanku_taobao_name,pid:a.taobaoke_pid},n=Object.assign(t,e);return i.post(`${a.haodanku_taobao_name}/ratesurl`,n,u).then(e=>{const t="string"==typeof e.data?JSON.parse(e.data):e.data;if(0===t.code)throw console.error("\u6293\u53d6\u6570\u636e\u5931\u8d25,msg:",t.msg),new Error(t.msg);return t})},get_deserve_item:()=>{return m("get_deserve_item",[],{},{})},get_trill_data:e=>{return m("get_trill_data",["min_id","cat_id","order","back"],{},e)},low_price_Pinkage_data:e=>{return m("low_price_Pinkage_data",["min_id","order","type"],{},e)},brandinfo:e=>{return m("brandinfo",["min_id","back","brandcat"],{},e)},sales_list:e=>{return m("sales_list",["sale_type","min_id","cid","back","item_type"],{},e)},selected_item:e=>{return m("selected_item",["min_id"],{},e)},hot_key:()=>{return m("hot_key",[],{},{})},get_similar_info:e=>{return m("get_similar_info",["itemid"],{},e)},item_detail:e=>{return m("item_detail",["itemid"],{},e)},supersearch:e=>{return m("supersearch",["keyword","back","min_id","tb_p","sort","is_tmall","is_coupon","limitrate","startprice"],{},e)},super_classify:e=>{return m("super_classify",[],{},e)},column:e=>{return m("column",["type","back","min_id","sort","cid","price_min","price_max","sale_min","sale_max","coupon_min","coupon_max","item_type"],{},e)}});const _=Object.assign(c,{haodanku:l}),p=["itemlist","item_detail","supersearch","super_classify","column"];const g={itemlist(e,t){e.itemlist.data.push(...t.data),e.itemlist.min_id=t.min_id,console.log("modiy itemlist")},item_detail(e,t){e.item_detail.data=t.data},supersearch(e,t){e.supersearch.data.push(...t.data),e.supersearch.min_id=t.min_id},super_classify(e,t){e.super_classify.data=t.general_classify},column(e,t){e.column.data.push(...t.data),e.column.min_id=t.min_id}};var h={namespaced:!0,state:function(){const e={};return p.forEach(t=>{e[t]={data:[],min_id:1}}),e}(),actions:function(){const e={};return p.forEach(t=>{e[t]=function({commit:e,state:n},a){const i=Object.assign({min_id:n[t].min_id},a);_.haodanku[t].call(this,i).then(n=>{e(t,n)})}}),e}(),mutations:g};e.use(t);const f=new t.Store({modules:{goods:h}});const k={goods:{actions:function(){const e={};return p.forEach(t=>{e[t]=function(e){f.dispatch(`goods/${t}`,e)}}),e}(),data:function(){const e={};return p.forEach(t=>{e[t+"_data"]=function(){return f.state.goods[t].data}}),e}()}};class y{}const w="undefined"!=typeof wx?(n(),()=>{let e="";return wx.pro.login().then(t=>(console.log("login res:",t),e=t.code,wx.pro.getSetting())).then(e=>{if(e.authSetting["scope.userInfo"])return wx.pro.getUserInfo();throw new y}).then(t=>{console.log("\u4ece\u5fae\u4fe1\u83b7\u53d6\u7528\u6237\u4fe1\u606f\u6210\u529f  ",t);const n={code:e,encrypted_data:t.encryptedData,iv:t.iv,raw_data:t.rawData,signature:t.signature};return _.wx.login(n)}).then(e=>(console.log("\u767b\u5f55API\u670d\u52a1\u5668\u6210\u529f",e),_.user.info()))}):()=>{};var b=Object.freeze({__proto__:null,getUserInfo:w});export default{version:"1.0.26",config:a,store:f,api:k,wxApi:b,rest:_};export{y as UserNotAuthorized,k as api,a as config,_ as rest,f as store,b as wxApi};