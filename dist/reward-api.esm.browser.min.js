/**
 * reward-api v1.0.30
 * (c) 2020 Jun Tsai
 * @license Apache-2.0
 */
import t from"vue";import e from"vuex";import{promisifyAll as i}from"wx-promise-pro";var s={haodankuApi:"https://v2.api.haodanku.com",haodankuKey:"gofanli",haodanku_taobao_name:"zhyj_cn",taobaoke_pid:"mm_19052242_1281300405_110017350452",api:"https://api.gofanli.cn",isWx:!1};class a{constructor({isWx:t}){if(t||"undefined"!=typeof wx){const t=require("flyio/dist/npm/wx");this.fly=new t}else this.fly=require("flyio");this.config=this.fly.config,this.interceptors=this.fly.interceptors,this.get=this.fly.get.bind(this.fly),this.post=this.fly.post.bind(this.fly)}}const n={headers:{"content-type":"application/x-www-form-urlencoded"}};var o=new class{fly(){return null==this.flyInstance&&(this.flyInstance=new a(s)),this.flyInstance}constructor(){this._post=((t,e)=>this.fly().post(`${s.api}${t}`,e,n).then(t=>t.data)),this._get=((t,e)=>this.fly().get(`${s.api}${t}`,e).then(t=>t.data)),this.internalSetToken=(t=>{this.fly().config.headers=Object.assign(this.fly().config.headers,{Authorization:"Bearer "+t})}),this.public={announces:()=>this._get("/public/announces"),slides:()=>this._get("/public/slides"),create_tpwd:({text:t,url:e,logo:i})=>this._post("/public/tpwd",{text:t,url:e,logo:i})},this.admin={add_card:({no:t,secret:e,amount:i,created_id:s})=>this._post("/admin/card/add",{no:t,secret:e,amount:i,created_id:s}),cards:({page:t,size:e,sort:i})=>this._get("/admin/card/list",{page:t,size:e,sort:i}),add_slide:({img_url:t,url:e,status:i})=>this._post("/admin/slide/add",{img_url:t,url:e,status:i}),delete_slide:t=>this._post("/admin/slide/delete",{id:t}),update_status:({id:t,status:e})=>this._post("/admin/slide/status",{id:t,status:e}),slides:()=>this._get("/admin/slide/list"),add_announce:({content:t,url:e})=>this._post("/admin/announce/add",{content:t,url:e}),delete_announce:t=>this._post("/admin/announce/delete",{id:t}),announces:()=>this._get("/admin/announce/list"),users:({page:t,size:e,sort:i})=>this._get("/admin/users",{page:t,size:e,sort:i})},this.consumption={add:({amount:t,item_id:e,item_img:i,item_link:s})=>this._post("/consumption/add",{amount:t,item_id:e,item_img:i,item_link:s}),list:({page:t,size:e,sort:i})=>this._get("/consumption/list",{page:t,size:e,sort:i})},this.recharge={add:({no:t,secret:e})=>this._post("/recharge/add",{no:t,secret:e}),list:({page:t,size:e,sort:i})=>this._get("/recharge/list",{page:t,size:e,sort:i})},this.user={setToken:this.internalSetToken,clearToken:()=>{delete this.fly().config.headers.Authorization},info:()=>this._get("/user/info"),sendSms:t=>this._post("/user/sendSms",{phone:t}),login:({phone:t,code:e})=>this._post("/user/login",{phone:t,code:e}).then(t=>(this.internalSetToken(t.token),t))},this.wx={login:t=>this._post("/wx/login",t).then(t=>(this.internalSetToken(t.token),t))}}};const r={headers:{"content-type":"application/x-www-form-urlencoded"}};var d=new class{fly(){return null==this.flyInstance&&(this.flyInstance=new a(s)),this.flyInstance}baseHaodanku(t,e,i,a){const n=Object.assign(i,a);let o=s.haodankuApi+"/"+t+"/apikey/"+s.haodankuKey;return e.forEach(t=>{n.hasOwnProperty(t)&&(o+="/"+t+"/"+n[t])}),this.fly().get(o,{},r).then(t=>{const e="string"==typeof t.data?JSON.parse(t.data):t.data;if(0===e.code)throw console.error("\u6293\u53d6\u6570\u636e\u5931\u8d25,\u670d\u52a1\u5668\u6d88\u606f:",e.msg),new Error(e.msg);return e})}itemlist(t){return this.baseHaodanku("itemlist",["nav","cid","back","min_id","sort","price_min","price_max","sale_min","sale_max","coupon_min","coupon_max","tkrates_min","tkrates_max","tkmoney_min","item_type"],{nav:3,cid:0,back:10,minId:1},t)}ratesurl(t){const e={apikey:s.haodankuKey,tb_name:s.haodanku_taobao_name,pid:s.taobaoke_pid},i=Object.assign(e,t);return this.fly().post(`${s.haodankuApi}/ratesurl`,i,r).then(t=>{const e="string"==typeof t.data?JSON.parse(t.data):t.data;if(0===e.code)throw console.error("\u6293\u53d6\u6570\u636e\u5931\u8d25,msg:",e.msg),new Error(e.msg);return e})}get_keyword_items(t){return this.baseHaodanku("get_keyword_items",["keyword","shopid","back","sort","cid","min_id","price_min","price_max","sale_min","sale_max","coupon_min","coupon_max","type"],{},t)}get_deserve_item(){return this.baseHaodanku("get_deserve_item",[],{},{})}get_trill_data(t){return this.baseHaodanku("get_trill_data",["min_id","cat_id","order","back"],{},t)}low_price_Pinkage_data(t){return this.baseHaodanku("low_price_Pinkage_data",["min_id","order","type"],{},t)}brandinfo(t){return this.baseHaodanku("brandinfo",["min_id","back","brandcat"],{},t)}sales_list(t){return this.baseHaodanku("sales_list",["sale_type","min_id","cid","back","item_type"],{},t)}selected_item(t){return this.baseHaodanku("selected_item",["min_id"],{},t)}hot_key(){return this.baseHaodanku("hot_key",[],{},{})}get_similar_info(t){return this.baseHaodanku("get_similar_info",["itemid"],{},t)}item_detail(t){return this.baseHaodanku("item_detail",["itemid"],{},t)}supersearch(t){return this.baseHaodanku("supersearch",["keyword","back","min_id","tb_p","sort","is_tmall","is_coupon","limitrate","startprice"],{},t)}super_classify(t){return this.baseHaodanku("super_classify",[],{},t)}column(t){return this.baseHaodanku("column",["type","back","min_id","sort","cid","price_min","price_max","sale_min","sale_max","coupon_min","coupon_max","item_type"],{},t)}};const c=Object.assign(o,{haodanku:d}),u=["itemlist","item_detail","supersearch","super_classify","column"];const l={itemlist(t,e){t.itemlist.data.push(...e.data),t.itemlist.min_id=e.min_id},item_detail(t,e){t.item_detail.data=e.data},supersearch(t,e){t.supersearch.data.push(...e.data),t.supersearch.min_id=e.min_id},super_classify(t,e){t.super_classify.data=e.general_classify},column(t,e){t.column.data.push(...e.data),t.column.min_id=e.min_id}};var _={namespaced:!0,state:function(){const t={};return u.forEach(e=>{t[e]={data:[],min_id:1}}),t}(),actions:function(){const t={};return u.forEach(e=>{t[e]=function({commit:t,state:i},s){const a=Object.assign({min_id:i[e].min_id},s);c.haodanku[e](a).then(i=>{t(e,i)})}}),t}(),mutations:l};t.use(e);const h=new e.Store({modules:{goods:_}});const m={goods:{actions:function(){const t={};return u.forEach(e=>{t[e]=function(t){h.dispatch(`goods/${e}`,t)}}),t}(),data:function(){const t={};return u.forEach(e=>{t[e+"_data"]=function(){return h.state.goods[e].data}}),t}()}};class p{}const g="undefined"!=typeof wx?(i(),()=>{let t="";return wx.pro.login().then(e=>(console.log("login res:",e),t=e.code,wx.pro.getSetting())).then(t=>{if(t.authSetting["scope.userInfo"])return wx.pro.getUserInfo();throw new p}).then(e=>{console.log("\u4ece\u5fae\u4fe1\u83b7\u53d6\u7528\u6237\u4fe1\u606f\u6210\u529f  ",e);const i={code:t,encrypted_data:e.encryptedData,iv:e.iv,raw_data:e.rawData,signature:e.signature};return c.wx.login(i)}).then(t=>(console.log("\u767b\u5f55API\u670d\u52a1\u5668\u6210\u529f",t),c.user.info()))}):()=>{};var f=Object.freeze({__proto__:null,getUserInfo:g});export default{version:"1.0.30",config:s,store:h,api:m,wxApi:f,rest:c};export{p as UserNotAuthorized,m as api,s as config,c as rest,h as store,f as wxApi};